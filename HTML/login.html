<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="noindex,nofollow" />
    <meta
      name="googlebot-news"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Stage Fright Band Website" />
    <link rel="canonical" href="https://stagefrightband.github.io" />
    <link rel="stylesheet" href="../CSS/login.css" />
    <script src="../JS/login.js"></script>
    <!-- SRI Hashes made with https://www.srihash.org/-->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
      integrity="sha256-jjsBF/TfS+RSwLavW48KCs+dSt4j0I1V1+MSryIHd2I="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"
      integrity="sha256-ZLh1yXjlzs4WxNoYOPyjkbA/IfnKzxq/+sPzGoIMHTY="
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

      // Initialize Supabase client
      const supabase = createClient(
        "https://cuxsndvcavwlffvywmfo.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHNuZHZjYXZ3bGZmdnl3bWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE4NzcwNDYsImV4cCI6MjA0NzQ1MzA0Nn0.UKmCIXv_qSKfeodEUQOVtgVU4pf9aHFMX1ygcV7NMYA"
      );
      document.addEventListener("DOMContentLoaded", () => {
        const loginButton = document.getElementById("loginButton");

        // Function to create cookies that never expire
        function createCookie(name, value) {
          const expires = "expires=Fri, 31 Dec 9999 23:59:59 GMT"; // Far future expiration date
          document.cookie = `${name}=${encodeURIComponent(
            value
          )}; ${expires}; path=/`;
        }

        loginButton.addEventListener("click", async (event) => {
          event.preventDefault(); // Prevent form submission behavior
          console.log("Login button clicked!"); // Debugging message

          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("passwordField").value;

          if (!username || !password) {
            alert("Please enter both username and password.");
            return;
          }

          try {
            const { data, error } = await supabase
              .from("encrypted-data")
              .select("*")
              .eq("username", username)
              .eq("password", password);

            if (error) {
              console.error("Error querying Supabase:", error);
              alert("An error occurred. Please try again.");
              return;
            }

            if (data && data.length > 0) {
              alert("Login successful!");
              // Retrieve shopping_items data
              const cartitems = data[0].cartitems || ""; // Default to empty string if no items
              createCookie("cartitems", cartitems);

              // Redirect to main page
              window.location.href = "../index.html";
            } else {
              alert("Invalid username or password.");
            }
          } catch (err) {
            console.error("Unexpected error:", err);
            alert("An error occurred. Please try again.");
          }
        });
      });
    </script>
    <title>Login - Stage Fright</title>
    
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../Images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../Images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../Images/favicon-16x16.png"
    />
    <link rel="icon" type="image/x-icon" href="../Images/favicon.ico" />
    <link rel="manifest" href="../site.webmanifest" />
  </head>

  <!-- Login icon obtained from https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.vecteezy.com%2Ffree-vector%2Flogin-icon&psig=AOvVaw1gsnfXABASMBCw_0OsnoO7&ust=1731690198618000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCOCU2eqm3IkDFQAAAAAdAAAAABAE-->

  <body>
    <div class="topnav">
      <a class="logo" href="../index.html"
        ><img
          src="../Images/Main logo fright.png"
          alt="Stage Fright Logo"
          width="10.434vh"
          class="logoimage"
      /></a>
      <a href="aboutus.html">About Us</a>
      <a href="contactus.html">Contact Us</a>
      <a href="store.html">Store</a>
      <a href="tourdates.html">Tour Dates</a>
      <a href="login.html">
        <img
          alt="Login Icon"
          style="width: 6.26vh; height: 6.26vh"
          src="../Images/login-icon.png"
        />
      </a>
      <a href="shoppingcart.html">
        <img
          alt="Shopping Cart Icon"
          style="width: 6.26vh; height: 6.26vh"
          src="../Images/shoppingcart.png"
        />
      </a>
      <a href="settings.html">
        <img
          alt="Accessibility Settings"
          style="width: 6.26vh; height: 6.26vh"
          src="../Images/accessibilityicon.png"
        />
      </a>
    </div>
    <br />
    <div style="text-align: center">
      <fieldset>
        <legend style="max-width: 25%">Login</legend>
        <br />
        <label for="username"></label>
        <input
          autocomplete="on"
          placeholder="Username"
          type="email"
          id="username"
          required
          name="username"
        /><br />
        <label for="password"></label><br />
        <input
          autocomplete="on"
          type="password"
          placeholder="Password"
          required
          id="passwordField"
          name="password"
        /><br />
        <input type="checkbox" onclick="showPassword()" />Show Password
        <br /><br />
        <button id="loginButton">Login</button>
        <br /><br />
        <a href="forgotpassword.html">Forgot Password</a><br />
      </fieldset>
    </div>

    <p style="text-align: center">
      Need an account? <a href="signup.html">Sign Up</a>
    </p>
  </body>
</html>
<!--
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";


  // Wait for DOM content to load before running other scripts
  document.addEventListener("DOMContentLoaded", function () {
    // Encryption function using CryptoJS
    function encryptData(data, key) {
      return CryptoJS.AES.encrypt(JSON.stringify(data), key).toString();
    }

    // Event listener for encryption
    document.getElementById("encryptButton").addEventListener("click", () => {
      const message = document.getElementById("encryptionMessage").value;
      const key = document.getElementById("encryptionKey").value;

      if (message && key) {
        const encrypted = encryptData(message, key);
        document.getElementById("encryptedMessage").value = encrypted;
      } else {
        alert("Please enter both a message and a key");
      }
    });

    // Event listener for sending encrypted data to Supabase
    document
      .getElementById("sendToSupabaseButton")
      .addEventListener("click", async () => {
        const encryptedMessage = document.getElementById("supabaseHash").value;
        const key = document.getElementById("supabaseKey").value;

        if (encryptedMessage && key) {
          try {
            // Insert encrypted message and key into Supabase table
            const { data, error } = await supabase
              .from("encrypted-data") // Table name is 'encrypted-data'
              .insert([
                { username: encryptedMessage, password: key }, // Store encrypted message in 'message' column and key in 'key' column
              ]);

            if (error) {
              console.error("Error inserting data:", error);
            } else {
              console.log("Data successfully inserted:", data);
              alert("Encrypted data has been sent to Supabase.");
            }
          } catch (error) {
            console.error("Error inserting data:", error);
            alert("An error occurred while sending data to Supabase.");
          }
        } else {
          alert("Please enter both encrypted hash and key.");
        }
      });
  });
</script>
-->
