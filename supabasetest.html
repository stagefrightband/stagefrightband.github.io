<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Encrypt Message and Send to Supabase</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <script type="module">
      import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

      // Initialize Supabase client
      const supabase = createClient(
        "https://cuxsndvcavwlffvywmfo.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHNuZHZjYXZ3bGZmdnl3bWZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzE4NzcwNDYsImV4cCI6MjA0NzQ1MzA0Nn0.UKmCIXv_qSKfeodEUQOVtgVU4pf9aHFMX1ygcV7NMYA"
      );

      // Wait for DOM content to load before running other scripts
      document.addEventListener("DOMContentLoaded", function () {
        // Encryption function using CryptoJS
        function encryptData(data, key) {
          return CryptoJS.AES.encrypt(JSON.stringify(data), key).toString();
        }

        // Event listener for encryption
        document
          .getElementById("encryptButton")
          .addEventListener("click", () => {
            const message = document.getElementById("encryptionMessage").value;
            const key = document.getElementById("encryptionKey").value;

            if (message && key) {
              const encrypted = encryptData(message, key);
              document.getElementById("encryptedMessage").value = encrypted;
            } else {
              alert("Please enter both a message and a key");
            }
          });

        // Event listener for sending encrypted data to Supabase
        document
          .getElementById("sendToSupabaseButton")
          .addEventListener("click", async () => {
            const encryptedMessage =
              document.getElementById("supabaseHash").value;
            const key = document.getElementById("supabaseKey").value;

            if (encryptedMessage && key) {
              try {
                // Insert encrypted message and key into Supabase table
                const { data, error } = await supabase
                  .from("encrypted-data") // Table name is 'encrypted-data'
                  .insert([
                    { username: encryptedMessage, password: key }, // Store encrypted message in 'message' column and key in 'key' column
                  ]);

                if (error) {
                  console.error("Error inserting data:", error);
                } else {
                  console.log("Data successfully inserted:", data);
                  alert("Encrypted data has been sent to Supabase.");
                }
              } catch (error) {
                console.error("Error inserting data:", error);
                alert("An error occurred while sending data to Supabase.");
              }
            } else {
              alert("Please enter both encrypted hash and key.");
            }
          });
      });
    </script>
  </head>
  <body>
    <h1>Encrypt Message and Send to Supabase</h1>

    <h2>Encrypt Message</h2>
    <div>
      <label for="encryptionMessage">Message:</label>
      <input type="text" id="encryptionMessage" placeholder="Enter message" />
    </div>
    <div>
      <label for="encryptionKey">Key:</label>
      <input
        type="text"
        id="encryptionKey"
        placeholder="Enter encryption key"
      />
    </div>
    <div>
      <button id="encryptButton">Encrypt</button>
    </div>
    <div>
      <label for="encryptedMessage">Encrypted Message:</label>
      <textarea
        id="encryptedMessage"
        placeholder="Encrypted message will appear here"
        readonly
      ></textarea>
    </div>

    <h2>Send Encrypted Data to Supabase</h2>
    <div>
      <label for="supabaseHash">Encrypted Hash:</label>
      <input
        type="text"
        id="supabaseHash"
        placeholder="Enter encrypted hash to send"
      />
    </div>
    <div>
      <label for="supabaseKey">Key:</label>
      <input type="text" id="supabaseKey" placeholder="Enter encryption key" />
    </div>
    <div>
      <button id="sendToSupabaseButton">Send to Supabase</button>
    </div>
  </body>
</html>